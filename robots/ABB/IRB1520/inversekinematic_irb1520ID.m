
function q = inversekinematic_irb1520ID(robot,T)

%asignamos cada valor de T a su correspondiente sacado del Derive6
r11=T(1,1);
r12=T(1,2);
r13=T(1,3);
t11=T(1,4);
r21=T(2,1);
r22=T(2,2);
r23=T(2,3);
t12=T(2,4);
r31=T(3,1);
r32=T(3,2);
r33=T(3,3);
t13=T(3,4);
r41=T(4,1);
r42=T(4,2);
r43=T(4,3);
t14=T(4,4);
%p=m+d6*z6
m=T(1:3,4)-0.2*T(1:3,3);
x=m(1,:);
y=m(2,:);
z=m(3,:);

 %para lambda = 1  
 %ambas soluciones de t designaremos como t_1 y t_2
 %al resolver t, hallamos la solucion de q2+q3 que designaremos cómo q23.
 
%% solucion para l=1 y t_1 (aquí hay 2 soluciones)
 l=1;
 %debajo tenemos el famoso chorizo de Weierstrass
t=(20*sqrt(2)*sqrt(4000*l*sqrt(x^2  + y^2 )*(50000*(l^2)*(x^2)  + 50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 34001) - 312500000*(l^4)*x^4  - 12500*(l^2)*(x^2) *(50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 31441) - 312500000*(l^4)*y^4  - 12500*(l^2)*(y^2) *(50000*z^2  - 45300*z - 31441) - 312500000*z^4  + 566250000*z^3  + 168501250*z^2  - 385061325*z + 100348956) - 200000*l*sqrt(x^2  + y^2 ) + 723000*z - 295519)/(563000*l*sqrt(x^2  + y^2 ) + 500000*(l^2)*x^2  + 500000*(l^2)*y^2  + 500000*z^2  - 253000*z + 16439);
q23=2*atan(t);

%con los despejes del derive                                      
sq2=(0.723*cos(q23) - 0.2*sin(q23) - l*sqrt(x^2  + y^2 ) + 0.16)/0.59;
cq2=-(0.2*cos(q23) + 0.723*sin(q23)- z + 0.453)/0.59;
 %utilizamos atan2 para despejar el valor de q2.               
q2=2*atan(sq2/(cq2+1));
q3=q23-q2;

%con los despejes del derive de nuevo.
cq1=x/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
sq1=y/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
%atan2=2*atan(sin/(1+cos))
q1=2*atan(sq1/(1+cq1));

%Ahora habría que despejar lo que viene a ser la solucion del desacople de
%la muñeca esférica, algo así cómo A_03*T=A_36, para así hallar los últimos
%tres ángulos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Primera solucion; q5=arccos(Chorizo)
%
q5=acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46 = -(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46 = (r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,1)=[q1,q2,q3,q4,q5,q6];

% Segunda solucion; q5=-arccos(Chorizo)
%
q5=-acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,2)=[q1,q2,q3,q4,q5,q6];

%% solucion para l=1 y t_2 (aquí hay 2 soluciones)
 l=1;
 %debajo tenemos el famoso chorizo de Weierstrass
t=(-20*sqrt(2)*sqrt(4000*l*sqrt(x^2  + y^2 )*(50000*(l^2)*(x^2)  + 50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 34001) - 312500000*(l^4)*x^4  - 12500*(l^2)*(x^2) *(50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 31441) - 312500000*(l^4)*y^4  - 12500*(l^2)*(y^2) *(50000*z^2  - 45300*z - 31441) - 312500000*z^4  + 566250000*z^3  + 168501250*z^2  - 385061325*z + 100348956) - 200000*l*sqrt(x^2  + y^2 ) + 723000*z - 295519)/(563000*l*sqrt(x^2  + y^2 ) + 500000*(l^2)*x^2  + 500000*(l^2)*y^2  + 500000*z^2  - 253000*z + 16439);
q23=2*atan(t);

%con los despejes del derive                                      
sq2=(0.723*cos(q23) - 0.2*sin(q23) - l*sqrt(x^2  + y^2 ) + 0.16)/0.59;
cq2=-(0.2*cos(q23) + 0.723*sin(q23)- z + 0.453)/0.59;
 %utilizamos atan2 para despejar el valor de q2.               
q2=2*atan(sq2/(cq2+1));
q3=q23-q2;

%con los despejes del derive de nuevo.
cq1=x/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
sq1=y/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
%atan2=2*atan(sin/(1+cos))
q1=2*atan(sq1/(1+cq1));

%Ahora habría que despejar lo que viene a ser la solucion del desacople de
%la muñeca esférica, algo así cómo A_03*T=A_36, para así hallar los últimos
%tres ángulos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Primera solucion; q5=arccos(Chorizo)
%
q5=acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,3)=[q1,q2,q3,q4,q5,q6];

% Segunda solucion; q5=-arccos(Chorizo)
%
q5=-acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,4)=[q1,q2,q3,q4,q5,q6];

%% solucion para l=-1 y t_1 (aquí hay 2 soluciones)
 l=-1;
 %debajo tenemos el famoso chorizo de Weierstrass
t=(20*sqrt(2)*sqrt(4000*l*sqrt(x^2  + y^2 )*(50000*(l^2)*(x^2)  + 50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 34001) - 312500000*(l^4)*x^4  - 12500*(l^2)*(x^2) *(50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 31441) - 312500000*(l^4)*y^4  - 12500*(l^2)*(y^2) *(50000*z^2  - 45300*z - 31441) - 312500000*z^4  + 566250000*z^3  + 168501250*z^2  - 385061325*z + 100348956) - 200000*l*sqrt(x^2  + y^2 ) + 723000*z - 295519)/(563000*l*sqrt(x^2  + y^2 ) + 500000*(l^2)*x^2  + 500000*(l^2)*y^2  + 500000*z^2  - 253000*z + 16439);
q23=2*atan(t);

%con los despejes del derive                                      
sq2=(0.723*cos(q23) - 0.2*sin(q23) - l*sqrt(x^2  + y^2 ) + 0.16)/0.59;
cq2=-(0.2*cos(q23) + 0.723*sin(q23)- z + 0.453)/0.59;
 %utilizamos atan2 para despejar el valor de q2.               
q2=2*atan(sq2/(cq2+1));
q3=q23-q2;

%con los despejes del derive de nuevo.
cq1=x/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
sq1=y/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
%atan2=2*atan(sin/(1+cos))
q1=2*atan(sq1/(1+cq1));

%Ahora habría que despejar lo que viene a ser la solucion del desacople de
%la muñeca esférica, algo así cómo A_03*T=A_36, para así hallar los últimos
%tres ángulos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Primera solucion; q5=arccos(Chorizo)
%
q5=acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,5)=[q1,q2,q3,q4,q5,q6];

% Segunda solucion; q5=-arccos(Chorizo)
%
q5=-acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,6)=[q1,q2,q3,q4,q5,q6];

%% solucion para l=-1 y t_2 (aquí hay 2 soluciones)
 l=-1;
 %debajo tenemos el famoso chorizo de Weierstrass
t=(-20*sqrt(2)*sqrt(4000*l*sqrt(x^2  + y^2 )*(50000*(l^2)*(x^2)  + 50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 34001) - 312500000*(l^4)*x^4  - 12500*(l^2)*(x^2) *(50000*(l^2)*y^2  + 50000*z^2  - 45300*z - 31441) - 312500000*(l^4)*y^4  - 12500*(l^2)*(y^2) *(50000*z^2  - 45300*z - 31441) - 312500000*z^4  + 566250000*z^3  + 168501250*z^2  - 385061325*z + 100348956) - 200000*l*sqrt(x^2  + y^2 ) + 723000*z - 295519)/(563000*l*sqrt(x^2  + y^2 ) + 500000*(l^2)*x^2  + 500000*(l^2)*y^2  + 500000*z^2  - 253000*z + 16439);
q23=2*atan(t);

%con los despejes del derive                                      
sq2=(0.723*cos(q23) - 0.2*sin(q23) - l*sqrt(x^2  + y^2 ) + 0.16)/0.59;
cq2=-(0.2*cos(q23) + 0.723*sin(q23)- z + 0.453)/0.59;
 %utilizamos atan2 para despejar el valor de q2.               
q2=2*atan(sq2/(cq2+1));
q3=q23-q2;

%con los despejes del derive de nuevo.
cq1=x/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
sq1=y/(cos(q2)*(0.723*cos(q3) - 0.2*sin(q3)) - sin(q2)*(0.2*cos(q3) + 0.723*sin(q3) + 0.59) + 0.16);
%atan2=2*atan(sin/(1+cos))
q1=2*atan(sq1/(1+cq1));

%Ahora habría que despejar lo que viene a ser la solucion del desacople de
%la muñeca esférica, algo así cómo A_03*T=A_36, para así hallar los últimos
%tres ángulos
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Primera solucion; q5=arccos(Chorizo)
%
q5=acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,7)=[q1,q2,q3,q4,q5,q6];

% Segunda solucion; q5=-arccos(Chorizo)
%
q5=-acos(r13*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3) - r13*cos(q1)*sin(q2)/sin(q3) + r23*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3) - r23*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r43*cos(q3) + (453*r43 - 1000*r33)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r43*cos(q3)^2 + (453*r43 - 1000*r33)*sin(q3)*cos(q3) - 80*r43) + 295*r43*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r33 - 453*r43)*cos(q3) + 160*r43*sin(q3)) - 590*r43*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))));


if abs(sin(q5))<0.0001    

    if cos(q5)==0
cq46=-(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5)
sq46=(r12*sin(q1) - r22*cos(q1))   
%un poco de atan2, al ser los dos giros sobre el mismo eje, los angulos son
%complementarios y se restan uno al otro.
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46-q4;

if cos(q5) == pi
   cq46=(r11*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r11*cos(q1)*cos(q2)/sin(q3) - r11*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r21*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r21*sin(q1)*cos(q2)/sin(q3) - r21*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r41*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r41*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r41*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r41*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r31*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r41*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r31*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r31*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r41*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r31*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r41*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r31*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r41*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r31*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r41*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r41*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r41*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r41*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r41*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r41*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r41*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r31*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r41*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r41*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r41*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r41*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r31*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r41*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r31*cos(q2)*cos(q3) - 453*r41*cos(q2)*cos(q3)/1000 + 4*r41*cos(q2)*sin(q3)/25 - 453*r41*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r31*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r41*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r41*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r41*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r41*sin(q2)*cos(q3)/25 - r31*sin(q2)/sin(q3)^3 + 453*r41*sin(q2)/(1000*sin(q3)^3) - 59*r41*cos(q3)/100 - r41/5);
sq46=(r12*sin(q1) - r22*cos(q1))  ;
q46=2*atan(sq46/(1+cq46));
q4=0;
q6=q46+q4;
end

    end
    
else
cq6=(r11*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r11*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r11*cos(q1)*cos(q2)*cos(q3) - r11*cos(q1)*sin(q2)/sin(q3) + r21*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r21*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r21*sin(q1)*cos(q2)*cos(q3) - r21*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r41*cos(q3) + (453*r41 - 1000*r31)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r41*cos(q3)^2 + (453*r41 - 1000*r31)*sin(q3)*cos(q3) - 80*r41) + 295*r41*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r31 - 453*r41)*cos(q3) + 160*r41*sin(q3)) - 590*r41*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/sin(q5);
sq6=(r12*cos(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r12*cos(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r12*cos(q1)*cos(q2)*cos(q3) - r12*cos(q1)*sin(q2)/sin(q3) + r22*sin(q1)*sin(q2)^2*cot(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r22*sin(q1)*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r22*sin(q1)*cos(q2)*cos(q3) - r22*sin(q1)*sin(q2)/sin(q3) - (cos(q2)^2*sin(q3)*(160*r42*cos(q3) + (453*r42 - 1000*r32)*sin(q3)) + 2*cos(q2)*(sin(q2)*(160*r42*cos(q3)^2 + (453*r42 - 1000*r32)*sin(q3)*cos(q3) - 80*r42) + 295*r42*sin(q3)^2) - sin(q2)*cos(q3)*(sin(q2)*((1000*r32 - 453*r42)*cos(q3) + 160*r42*sin(q3)) - 590*r42*sin(q3)))/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))))/(-sin(q5));
cq4=(r13*cos(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r13*cos(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r13*cos(q1)*cos(q2)*cos(q3)^2/sin(q3) - r13*cos(q1)*cos(q2)/sin(q3) - r13*cos(q1)*sin(q2)*cos(q3)/sin(q3)^2 + r23*sin(q1)*sin(q2)^2*cot(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) - r23*sin(q1)*cos(q3)^2/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 2*r23*sin(q1)*cos(q2)*cos(q3)^2/sin(q3) - r23*sin(q1)*cos(q2)/sin(q3) - r23*sin(q1)*sin(q2)*cos(q3)/sin(q3)^2 - 12*r43*sin(q2)*cos(q2)*cos(q3)^5/(25*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 24*r43*sin(q2)^2*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r43*sin(q2)^2*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + 4077*r43*sin(q2)^2*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 4*r33*sin(q2)^2*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 84*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - 36*r43*sin(q2)^2*cos(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) + r33*sin(q2)^2*cos(q3)/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))) - r33*sin(q3)*cos(q3)/(cos(q2)*sin(q3) + sin(q2)*cos(q3)) + 16*r43*sin(q2)^3*cos(q3)^5/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^4/(500*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 2*r33*sin(q2)^3*cos(q3)^4/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)^3/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 1359*r43*sin(q2)^3*cos(q3)^2/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + r33*sin(q2)^3*cos(q3)^2/(sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^3*cos(q3)/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 1359*r43*sin(q2)*sin(q3)*cos(q3)^2/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - r33*sin(q2)*cos(q3)^2/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) + 4*r43*sin(q2)*cos(q3)/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^2) - 4*r43*sin(q2)^4*cos(q3)^8/(5*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 16*r43*sin(q2)^4*cos(q3)^6/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*cos(q3)^5/(1000*sin(q3)^3*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 56*r43*sin(q2)^4*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 28*r43*sin(q2)^4*cot(q3)^4/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^4/(5*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 453*r43*sin(q2)^4*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 1359*r43*sin(q2)^4*cos(q3)^3/(1000*sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - r33*sin(q2)^4*cot(q3)^3/(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3 - 453*r43*sin(q2)^4*cot(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 4*r43*sin(q2)^4*cos(q3)^2/(25*sin(q3)^4*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 8*r43*sin(q2)^2*cos(q3)^4/(25*sin(q3)^2*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 1359*r43*sin(q2)^2*sin(q3)*cos(q3)^3/(1000*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + r33*sin(q2)^2*cos(q3)^3/(sin(q3)*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) - 4*r43*sin(q2)^2*cot(q3)^2/(25*(cos(q2)*sin(q3) + sin(q2)*cos(q3))^3) + 2*r33*cos(q2)*cos(q3) - 453*r43*cos(q2)*cos(q3)/1000 + 4*r43*cos(q2)*sin(q3)/25 - 453*r43*sin(q2)*cos(q3)^2/(250*sin(q3)) + 2*r33*sin(q2)*cos(q3)^2/sin(q3)^3 - 453*r43*sin(q2)*cos(q3)^2/(1000*sin(q3)^3) - 28*r43*sin(q2)*cos(q3)/(25*sin(q3)^2) + 12*r43*sin(q2)*cos(q3)/(25*sin(q3)^4) + 16*r43*sin(q2)*cos(q3)/25 - r33*sin(q2)/sin(q3)^3 + 453*r43*sin(q2)/(1000*sin(q3)^3) - 59*r43*cos(q3)/100 - r43/5)/sin(q5);
sq4=(r13*sin(q1) - r23*cos(q1))/sin(q5);
%un poquito de atan2
q6=2*atan(sq6/(1+cq6));
q4=2*atan(sq4/(1+cq4));
end
%he aquí lo que interesa
q(1:6,8)=[q1,q2,q3,q4,q5,q6];

%normalizamos

% q=normalize(q)*pi;


end